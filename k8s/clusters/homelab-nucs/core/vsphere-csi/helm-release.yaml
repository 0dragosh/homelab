---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: vsphere-csi
  namespace: vmware-system-csi
spec:
  interval: 5m
  install:
    disableWait: true
    remediation:
      retries: 100
  upgrade:
    remediation:
      retries: 100
  chart:
    spec:
      # renovate: registryUrl=https://vsphere-tmm.github.io/helm-charts
      chart: vsphere-csi
      version: 2.2.0
      sourceRef:
        kind: HelmRepository
        name: vsphere-tmm
        namespace: flux-system
  values:
    global:
      config:
        storageclass:
          enabled: true
          expansion: true
        vcenter:
          vcsa:
            server: ${VCENTER_ADDRESS}
            user: ${VCENTER_CSI_USER}
            password: ${VCENTER_CSI_PASSWORD}
            datacenters:
              - ${VCENTER_DATACENTER}
